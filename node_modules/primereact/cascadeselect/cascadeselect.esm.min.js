import*as e from"react";import n,{PrimeReactContext as t}from"primereact/api";import{ComponentBase as r,useHandleStyle as o}from"primereact/componentbase";import{CSSTransition as a}from"primereact/csstransition";import{useMergeProps as l,useMountEffect as i,useUpdateEffect as c,useOverlayListener as u,useDisplayOrder as s,useGlobalOnEscapeKey as p,ESC_KEY_HANDLING_PRIORITIES as d,useUnmountEffect as f}from"primereact/hooks";import{ChevronDownIcon as m}from"primereact/icons/chevrondown";import{SpinnerIcon as b}from"primereact/icons/spinner";import{OverlayService as v}from"primereact/overlayservice";import{Portal as y}from"primereact/portal";import{classNames as h,DomHandler as g,ObjectUtils as w,IconUtils as O,UniqueComponentId as S,ZIndexUtils as E}from"primereact/utils";import{AngleRightIcon as x}from"primereact/icons/angleright";import{Ripple as I}from"primereact/ripple";function P(){return P=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},P.apply(this,arguments)}function j(e){return j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},j(e)}function G(e,n){if("object"!==j(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!==j(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}function C(e){var n=G(e,"string");return"symbol"===j(n)?n:String(n)}function A(e,n,t){return(n=C(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function D(e){if(Array.isArray(e))return e}function N(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var r,o,a,l,i=[],c=!0,u=!1;try{if(a=(t=t.call(e)).next,0===n){if(Object(t)!==t)return;c=!1}else for(;!(c=(r=a.call(t)).done)&&(i.push(r.value),i.length!==n);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=t.return&&(l=t.return(),Object(l)!==l))return}finally{if(u)throw o}}return i}}function k(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function L(e,n){if(e){if("string"==typeof e)return k(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?k(e,n):void 0}}function R(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function T(e,n){return D(e)||N(e,n)||L(e,n)||R()}var H=r.extend({defaultProps:{__TYPE:"CascadeSelect",appendTo:null,ariaLabelledBy:null,autoFocus:!1,breakpoint:void 0,className:null,dataKey:null,disabled:!1,loadingIcon:null,dropdownIcon:null,id:null,inputId:null,inputRef:null,itemTemplate:null,name:null,onBeforeHide:null,onBeforeShow:null,onChange:null,onGroupChange:null,onHide:null,onShow:null,optionGroupChildren:null,optionGroupIcon:null,optionGroupLabel:null,optionLabel:null,optionValue:null,options:null,placeholder:null,scrollHeight:"400px",style:null,tabIndex:null,transitionOptions:null,value:null,children:void 0},css:{classes:{root:function(e){var n=e.props,t=e.focusedState;return h("p-cascadeselect p-component p-inputwrapper",{"p-disabled":n.disabled,"p-focus":t,"p-inputwrapper-filled":n.value,"p-inputwrapper-focus":t||e.overlayVisibleState},n.className)},label:function(e){var n=e.props,t=e.label;return h("p-cascadeselect-label ",{"p-placeholder":t===n.placeholder,"p-cascadeselect-label-empty":!n.value&&"p-emptylabel"===t})},list:function(e){var t=e.context;return h("p-cascadeselect-panel p-cascadeselect-items",{"p-input-filled":t&&"filled"===t.inputStyle||"filled"===n.inputStyle,"p-ripple-disabled":t&&!1===t.ripple||!1===n.ripple})},sublist:"p-cascadeselect-panel p-cascadeselect-items p-cascadeselect-sublist",item:function(e){return h("p-cascadeselect-item",{"p-cascadeselect-item-group":e.isGroup,"p-cascadeselect-item-active p-highlight":e.isSelected})},dropdownIcon:"p-cascadeselect-trigger-icon",loadingIcon:"p-cascadeselect-trigger-icon",dropdownButton:"p-cascadeselect-trigger",loadingButton:"p-cascadeselect-trigger",wrapper:"p-cascadeselect-items-wrapper",panel:"p-cascadeselect-panel p-component",content:"p-cascadeselect-item-content",optionGroupIcon:"p-cascadeselect-group-icon",text:"p-cascadeselect-item-text",transition:"p-connected-overlay"},styles:"\n@layer primereact {\n    .p-cascadeselect {\n        display: inline-flex;\n        cursor: pointer;\n        position: relative;\n        user-select: none;\n    }\n    \n    .p-cascadeselect-trigger {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        flex-shrink: 0;\n    }\n    \n    .p-cascadeselect-label {\n        display: block;\n        white-space: nowrap;\n        overflow: hidden;\n        flex: 1 1 auto;\n        width: 1%;\n        text-overflow: ellipsis;\n        cursor: pointer;\n    }\n    \n    .p-cascadeselect-label-empty {\n        overflow: hidden;\n        visibility: hidden;\n    }\n    \n    .p-cascadeselect .p-cascadeselect-panel {\n        min-width: 100%;\n    }\n    \n    .p-cascadeselect-panel {\n        position: absolute;\n        top: 0;\n        left: 0;\n    }\n    \n    .p-cascadeselect-item {\n        cursor: pointer;\n        font-weight: normal;\n        white-space: nowrap;\n    }\n    \n    .p-cascadeselect-item-content {\n        display: flex;\n        align-items: center;\n        overflow: hidden;\n        position: relative;\n    }\n    \n    .p-cascadeselect-group-icon {\n        margin-left: auto;\n    }\n    \n    .p-cascadeselect-items {\n        margin: 0;\n        padding: 0;\n        list-style-type: none;\n        min-width: 100%;\n    }\n    \n    .p-fluid .p-cascadeselect {\n        display: flex;\n    }\n    \n    .p-fluid .p-cascadeselect .p-cascadeselect-label {\n        width: 1%;\n    }\n    \n    .p-cascadeselect-sublist {\n        position: absolute;\n        min-width: 100%;\n        z-index: 1;\n        display: none;\n    }\n    \n    .p-cascadeselect-item-active {\n        overflow: visible;\n    }\n    \n    .p-cascadeselect-item-active > .p-cascadeselect-sublist {\n        display: block;\n        left: 100%;\n        top: 0;\n    }\n}\n"}});function B(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function V(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?B(Object(t),!0).forEach((function(n){A(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):B(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var F=e.memo((function(n){var r=l(),o=T(e.useState(null),2),a=o[0],u=o[1],s=e.useRef(null),p=e.useContext(t),d=n.ptm,f=n.cx,m=function(e,t){return d(e,{hostName:n.hostName,state:V({},t)})},b=function(e){n.onOptionSelect&&n.onOptionSelect(e)},v=function(e,t){var r=e.currentTarget.parentElement;switch(e.key){case"Down":case"ArrowDown":var o=y(r);o&&o.children[0].focus();break;case"Up":case"ArrowUp":var l=S(r);l&&l.children[0].focus();break;case"Right":case"ArrowRight":A(t)&&(a===t?r.children[1].children[0].children[0].focus():u(t));break;case"Left":case"ArrowLeft":u(null);var i=e.currentTarget.parentElement.parentElement.previousElementSibling;i&&i.focus();break;case"Enter":E(e,t);break;case"Tab":case"Escape":n.onPanelHide&&(n.onPanelHide(),e.preventDefault())}e.preventDefault()},y=function e(n){var t=n.nextElementSibling;return t?g.hasClass(t,"p-disabled")||!g.hasClass(t,"p-cascadeselect-item")?e(t):t:null},S=function e(n){var t=n.previousElementSibling;return t?g.hasClass(t,"p-disabled")||!g.hasClass(t,"p-cascadeselect-item")?e(t):t:null},E=function(e,t){A(t)?(u((function(e){return e===t?null:t})),n.onOptionGroupSelect&&n.onOptionGroupSelect({originalEvent:e,value:t})):n.onOptionSelect&&n.onOptionSelect({originalEvent:e,value:C(t)})},j=function(e){n.onOptionGroupSelect&&n.onOptionGroupSelect(e)},G=function(e){return n.optionLabel?w.resolveFieldData(e,n.optionLabel):e},C=function(e){return n.optionValue?w.resolveFieldData(e,n.optionValue):e},A=function(e){return Object.prototype.hasOwnProperty.call(e,n.optionGroupChildren[n.level])},D=function(e){return A(e)?(t=e,n.optionGroupLabel?w.resolveFieldData(t,n.optionGroupLabel):null):G(e);var t};i((function(){if(n.selectionPath&&n.options&&!n.dirty){var e=n.options.find((function(e){return n.selectionPath.includes(e)}));e&&u(e)}var t,r,o,a,l;n.root||(r=g.getOffset(t=s.current.parentElement),o=g.getViewport(),a=s.current.offsetParent?s.current.offsetWidth:g.getHiddenElementOuterWidth(element),l=g.getOuterWidth(t.children[0]),parseInt(r.left,10)+l+a>o.width-g.calculateScrollbarWidth()&&(s.current.style.left="-100%"))})),c((function(){n.parentActive||u(null)}),[n.parentActive]);var N=function(t){if(A(t)&&a===t){var r=w.resolveFieldData(t,n.optionGroupChildren[n.level]),o=a===t,l=n.level+1;return e.createElement(F,{hostName:n.hostName,options:r,className:f("sublist"),selectionPath:n.selectionPath,optionLabel:n.optionLabel,optionValue:n.optionValue,level:l,onOptionSelect:b,onOptionGroupSelect:j,parentActive:o,optionGroupLabel:n.optionGroupLabel,optionGroupChildren:n.optionGroupChildren,dirty:n.dirty,template:n.template,onPanelHide:n.onPanelHide,ptm:d,cx:f})}return null},k=function(t,o){var l=N(t),i=r({className:f("text")},m("text")),c=n.template?w.getJSXElement(n.template,C(t)):e.createElement("span",i,D(t)),u=r({className:f("optionGroupIcon")},m("optionGroupIcon")),s=n.optionGroupIcon||e.createElement(x,u),p=A(t)&&O.getJSXIcon(s,V({},u),{props:n}),d=D(t)+"_"+o,b=r({className:f("content"),onClick:function(e){return E(e,t)},tabIndex:0,onKeyDown:function(e){return v(e,t)}},m("content")),y=a===t,g=A(t),S=r({className:h(t.className,f("item",{option:t,isGroup:g,isSelected:y})),style:t.style,role:"none","data-p-item-group":g,"data-p-highlight":y},m("item",{selected:y,group:g}));return e.createElement("li",P({key:d},S),e.createElement("div",b,c,p,e.createElement(I,null)),l)},L=n.options?n.options.map(k):null,R=r({ref:s,className:f(0===n.level?"list":"sublist",{context:p}),role:"listbox","aria-orientation":"horizontal"},m(0===n.level?"list":"sublist"));return e.createElement("ul",R,L)}));function _(e,n){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=K(e))||n&&e&&"number"==typeof e.length){t&&(e=t);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,l=!0,i=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return l=e.done,e},e:function(e){i=!0,a=e},f:function(){try{l||null==t.return||t.return()}finally{if(i)throw a}}}}function K(e,n){if(e){if("string"==typeof e)return M(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?M(e,n):void 0}}function M(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function U(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function z(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?U(Object(t),!0).forEach((function(n){A(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):U(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var J=e.memo(e.forwardRef((function(r,h){var x=l(),I=e.useContext(t),j=H.getProps(r,I),G=T(e.useState(!1),2),C=G[0],A=G[1],D=T(e.useState(!1),2),N=D[0],k=D[1],L=T(e.useState(null),2),R=L[0],B=L[1],V=H.setMetaData({props:j,state:{focused:C,overlayVisible:N,attributeSelector:R},context:z({},I)}),K=V.ptm,M=V.cx;o(H.css.styles,V.isUnstyled,{name:"cascadeselect"});var U=e.useRef(null),J=e.useRef(null),W=e.useRef(null),X=e.useRef(null),Z=e.useRef(null),$=e.useRef(!1),q=e.useRef(null),Y=T(u({target:U,overlay:J,listener:function(e,n){n.valid&&me()},when:N}),2),Q=Y[0],ee=Y[1],ne=s("cascade-select",N);p({callback:function(){me()},when:N&&ne,priority:[d.CASCADE_SELECT,ne]});var te=function(e){j.onChange&&j.onChange({originalEvent:e,value:e.value}),ce(),me(),g.focus(W.current)},re=function(e){$.current=!0,j.onGroupChange&&j.onGroupChange(e)},oe=function(e){return(j.optionLabel?w.resolveFieldData(e,j.optionLabel):e)||e},ae=function(e){return j.optionValue?w.resolveFieldData(e,j.optionValue):e},le=function(e,n){return w.resolveFieldData(e,j.optionGroupChildren[n])},ie=function(e,n){return Object.prototype.hasOwnProperty.call(e,j.optionGroupChildren[n])},ce=function(){var e;if(null!=j.value&&j.options){var n,t=_(j.options);try{for(t.s();!(n=t.n()).done;){if(e=ue(n.value,0))break}}catch(e){t.e(e)}finally{t.f()}}q.current=e},ue=function e(n,t){if(ie(n,t)){var r,o,a=_(le(n,t));try{for(a.s();!(o=a.n()).done;){if(r=e(o.value,t+1))return r.unshift(n),r}}catch(e){a.e(e)}finally{a.f()}}else if(w.equals(j.value,ae(n),j.dataKey))return[n];return null},se=function(){A(!0)},pe=function(){A(!1)},de=function(e){switch(e.which){case 40:N?g.findSingle(J.current,'[data-pc-section="item"]').children[0].focus():e.altKey&&j.options&&j.options.length&&fe(),e.preventDefault();break;case 32:N?me():fe(),e.preventDefault();break;case 9:me()}},fe=function(){j.onBeforeShow&&j.onBeforeShow(),k(!0)},me=function(){j.onBeforeHide&&j.onBeforeHide(),k(!1),g.focus(W.current)},be=function(){E.set("overlay",J.current,I&&I.autoZIndex||n.autoZIndex,I&&I.zIndex.overlay||n.zIndex.overlay),g.addStyles(J.current,{position:"absolute",top:"0",left:"0"}),ge(),R&&j.breakpoint&&(J.current.setAttribute(R+"_panel",""),we())},ve=function(){Q(),j.onShow&&j.onShow()},ye=function(){ee(),$.current=!1},he=function(){E.clear(J.current),j.onHide&&j.onHide(),Oe()},ge=function(){g.alignOverlay(J.current,X.current.parentElement,j.appendTo||I&&I.appendTo||n.appendTo)},we=function(){if(!Z.current){Z.current=g.createInlineStyle(I&&I.nonce||n.nonce,I&&I.styleContainer);var e="".concat(R,"_panel"),t="\n@media screen and (max-width: ".concat(j.breakpoint,") {\n    .p-cascadeselect-panel[").concat(e,"] .p-cascadeselect-items-wrapper > ul {\n        max-height: ").concat(j.scrollHeight,";\n        overflow: ").concat(j.scrollHeight?"auto":"",";\n    }\n\n    .p-cascadeselect-panel[").concat(e,"] .p-cascadeselect-sublist {\n        position: relative;\n    }\n\n    .p-cascadeselect-panel[").concat(e,"] .p-cascadeselect-item-active > .p-cascadeselect-sublist {\n        left: 0;\n        box-shadow: none;\n        border-radius: 0;\n        padding: 0 0 0 calc(var(--inline-spacing) * 2); /* @todo */\n    }\n\n    .p-cascadeselect-panel[").concat(e,'] .p-cascadeselect-group-icon:before {\n        content: "\\e930";\n    }\n}\n');Z.current.innerHTML=t}},Oe=function(){Z.current=g.removeInlineStyle(Z.current)};e.useImperativeHandle(h,(function(){return{props:j,getElement:function(){return U.current},getOverlay:function(){return J.current},getInput:function(){return W.current},getLabel:function(){return X.current},focus:function(){return g.focus(W.current)}}})),i((function(){j.breakpoint&&!R&&B(S()),j.autoFocus&&g.focus(W.current,j.autoFocus),ge()})),e.useEffect((function(){w.combinedRefs(W,j.inputRef)}),[W,j.inputRef]),c((function(){ce()}),[j.value]),f((function(){E.clear(J.current)}));var Se=function(){var n=x({className:M("dropdownIcon")},K("dropdownIcon")),t=O.getJSXIcon(j.dropdownIcon||e.createElement(m,n),z({},n),{props:j}),r=x({className:M("dropdownButton"),role:"button","aria-haspopup":"listbox","aria-expanded":N},K("dropdownButton"));return e.createElement("div",r,t)},Ee=x({className:M("wrapper")},K("wrapper")),xe=x({ref:J,className:M("panel"),onClick:function(e){v.emit("overlay-click",{originalEvent:e,target:U.current})}},K("panel")),Ie=function(){var n=x({classNames:M("transition"),in:N,timeout:{enter:120,exit:100},options:j.transitionOptions,unmountOnExit:!0,onEnter:be,onEntered:ve,onExit:ye,onExited:he},K("transition")),t=e.createElement(a,P({nodeRef:J},n),e.createElement("div",xe,e.createElement("div",Ee,e.createElement(F,{hostName:"CascadeSelect",options:j.options,selectionPath:q.current,optionGroupIcon:j.optionGroupIcon,optionLabel:j.optionLabel,optionValue:j.optionValue,parentActive:null!=j.value,level:0,optionGroupLabel:j.optionGroupLabel,optionGroupChildren:j.optionGroupChildren,onOptionSelect:te,onOptionGroupSelect:re,root:!0,template:j.itemTemplate,onPanelHide:me,ptm:K,cx:M}))));return e.createElement(y,{element:t,appendTo:j.appendTo})},Pe=H.getOtherProps(j);w.reduceKeys(Pe,g.DATA_PROPS);var je,Ge,Ce,Ae,De,Ne,ke,Le,Re,Te,He,Be,Ve,Fe=w.reduceKeys(Pe,g.ARIA_PROPS);return je=j.value?oe(j.value):void 0,Ge=x({className:"p-hidden-accessible"},K("hiddenSelectedMessage")),Ce=x(z({ref:W,type:"text",id:j.inputId,name:j.name,defaultValue:je,readOnly:!0,disabled:j.disabled,onFocus:se,onBlur:pe,onKeyDown:function(e){return de(e)},tabIndex:j.tabIndex,"aria-haspopup":"listbox"},Fe),K("input")),Re=e.createElement("div",Ge,e.createElement("input",Ce)),Ae=j.value?oe(j.value):j.placeholder||"p-emptylabel",De=x({ref:X,className:M("label",{label:Ae})},K("label",{context:z({label:Ae},I)})),Te=e.createElement("span",De,Ae),He=j.loading?(Ne=x({className:M("loadingIcon")},K("loadingIcon")),ke=O.getJSXIcon(j.loadingIcon||e.createElement(b,{spin:!0}),z({},Ne),{props:j}),Le=x({className:M("loadingButton"),role:"button","aria-haspopup":"listbox","aria-expanded":N},K("dropdownButton")),e.createElement("div",Le,ke)):Se(),Be=Ie(),Ve=x({id:j.id,ref:U,className:M("root",{focusedState:C,overlayVisibleState:N}),style:j.style,onClick:function(e){return n=e,void(j.disabled||j.loading||J.current&&J.current.contains(n.target)||(g.focus(W.current),N?me():fe()));var n}},Pe,K("root")),e.createElement("div",Ve,Re,Te,He,Be)})));J.displayName="CascadeSelect";export{J as CascadeSelect};
